# Consultas SQL - Salud y Vida

*"Atención que entiende a tu familia"*

Este conjunto de consultas SQL permite gestionar el sistema integral de la clínica Salud y Vida, desde operaciones básicas hasta análisis complejos para la toma de decisiones médicas y administrativas.

## Básico

**1. Listado de todos los pacientes activos**
Obtener una lista completa de todos los pacientes registrados en la clínica, mostrando sus datos personales básicos ordenados alfabéticamente por apellido.

**2. Médicos por especialidad**
Mostrar todos los médicos registrados agrupados por su especialidad médica, incluyendo información sobre su tipo de contrato (empleado o independiente).

**3. Consultas programadas para hoy**
Listar todas las citas médicas programadas para el día actual, incluyendo hora, paciente, médico y tipo de consulta.

**4. Medicamentos disponibles en farmacia**
Mostrar el inventario actual de medicamentos disponibles en la farmacia, incluyendo nombre, presentación, cantidad en stock y precio.

**5. Análisis clínicos pendientes de entrega**
Identificar todos los análisis clínicos que han sido procesados pero aún no han sido entregados a los pacientes.

**6. Recetas emitidas esta semana**
Obtener todas las recetas médicas emitidas en los últimos 7 días, mostrando médico que la emitió, paciente y fecha.

**7. Pacientes con citas de cardiología**
Listar todos los pacientes que tienen citas programadas en el área de cardiología, ordenados por fecha de cita.

**8. Dependientes registrados por cliente**
Mostrar la relación entre clientes y sus dependientes menores de edad registrados en el sistema.

**9. Servicios de imagenología del mes**
Listar todos los estudios de imagenología (rayos X, tomografía, resonancia) realizados en el mes actual.

**10. Médicos empleados con horarios fijos**
Identificar todos los médicos que son empleados directos de la clínica con horarios establecidos.

**11. Pagos pendientes por servicios**
Mostrar todos los servicios médicos que han sido proporcionados pero aún no han sido pagados por los pacientes.

**12. Alergias más comunes en pacientes**
Listar las alergias más frecuentemente reportadas en los expedientes médicos de los pacientes.

**13. Clientes con múltiples dependientes**
Identificar clientes que tienen más de un dependiente registrado bajo su responsabilidad.

**14. Consultas de medicina general de la semana**
Obtener todas las consultas de medicina general realizadas en los últimos 7 días.

**15. Medicamentos próximos a vencer**
Identificar medicamentos en farmacia que están próximos a su fecha de vencimiento (siguiente mes).

**16. Especialidades médicas disponibles**
Mostrar todas las especialidades médicas que ofrece la clínica Salud y Vida.

**17. Pacientes mayores de 65 años**
Listar todos los pacientes de la tercera edad registrados en el sistema para programas de atención geriátrica.

**18. Estudios de laboratorio en proceso**
Identificar análisis clínicos que han sido ordenados pero aún están en proceso de ejecución.

**19. Médicos independientes con mayor actividad**
Mostrar los médicos independientes que han atendido más consultas en el último mes.

**20. Historiales médicos incompletos**
Identificar pacientes cuyos expedientes médicos están incompletos, faltando información sobre antecedentes médicos o familiares.

---

*Nivel Básico completado. Estas consultas cubren las operaciones fundamentales de consulta del sistema de gestión médica, enfocándose en la selección y filtrado básico de información clínica y administrativa.*

## Intermedio

**21. Médicos con mayor número de consultas por especialidad**
Calcular y mostrar los médicos que han atendido más consultas en cada especialidad médica, incluyendo el total de consultas y el promedio mensual de atención.

**22. Análisis de ingresos por servicios médicos**
Mostrar un resumen financiero de todos los servicios médicos ofrecidos, agrupados por tipo de servicio, incluyendo ingresos totales, número de servicios prestados y ticket promedio.

**23. Pacientes con tratamientos múltiples simultáneos**
Identificar pacientes que están siguiendo más de un tratamiento médico al mismo tiempo, mostrando los medicamentos prescritos y las fechas de inicio de cada tratamiento.

**24. Eficiencia de entrega de resultados de laboratorio**
Calcular el tiempo promedio entre la toma de muestra y la entrega de resultados para cada tipo de análisis clínico, identificando los estudios con mayor demora.

**25. Comparación de demanda entre médicos empleados e independientes**
Analizar la distribución de consultas entre médicos empleados y médicos independientes, calculando porcentajes de ocupación y ingresos generados por cada grupo.

**26. Medicamentos más prescritos por especialidad**
Determinar qué medicamentos son más frecuentemente recetados en cada especialidad médica, incluyendo dosis promedio y duración típica del tratamiento.

**27. Análisis de alergias por grupo etario**
Estudiar la distribución de alergias reportadas agrupadas por rangos de edad (0-12, 13-18, 19-65, 65+), calculando prevalencia y tipos más comunes por grupo.

**28. Servicios no utilizados por falta de pago**
Identificar servicios médicos que fueron ordenados pero no se realizaron debido a pagos pendientes, calculando el impacto económico y por especialidad.

**29. Clientes con mayor gasto médico familiar**
Mostrar los clientes que han tenido mayor gasto médico total incluyendo sus dependientes, con desglose por tipo de servicio y período de tiempo.

**30. Ocupación de consultorios por horario**
Analizar la utilización de consultorios médicos por franjas horarias, identificando horas pico, horas valle y consultorios subutilizados.

**31. Pacientes que requieren seguimiento médico**
Identificar pacientes con enfermedades crónicas o tratamientos que requieren consultas de seguimiento periódicas, calculando próximas fechas recomendadas.

**32. Análisis de recetas no surtidas completamente**
Estudiar recetas médicas que no pudieron ser surtidas completamente por falta de inventario, agrupadas por medicamento y impacto en tratamientos.

**33. Estudios de imagenología: tiempo de procesamiento**
Calcular el tiempo promedio de procesamiento para cada tipo de estudio de imagenología, desde la orden médica hasta la entrega del informe.

**34. Médicos con especialización múltiple**
Identificar médicos que atienden en más de una especialidad, mostrando la distribución de consultas y eficiencia en cada área de práctica.

**35. Análisis de reingresos de pacientes**
Estudiar pacientes que han regresado a consulta dentro de 7 días de su última visita, identificando posibles problemas de diagnóstico o tratamiento inicial.

**36. Inventario crítico de medicamentos por categoría**
Analizar el inventario de medicamentos agrupado por categoría terapéutica, identificando productos con stock crítico y rotación lenta.

**37. Dependientes con mayor frecuencia de consulta**
Identificar dependientes menores de edad que han requerido atención médica con mayor frecuencia, analizando patrones de salud por grupo etario.

**38. Servicios médicos con mayor margen de ganancia**
Calcular el margen de ganancia por cada tipo de servicio médico, considerando costos operativos y precios de venta.

**39. Médicos independientes: análisis de comisiones**
Analizar las comisiones generadas por médicos independientes, mostrando ingresos totales para la clínica y distribución por especialidad.

**40. Pacientes sin consulta médica reciente**
Identificar pacientes registrados que no han tenido consultas médicas en los últimos 12 meses, para campañas de seguimiento y medicina preventiva.

**41. Intersección de pacientes con múltiples especialidades**
Utilizar operaciones de conjuntos para identificar pacientes que han sido atendidos por múltiples especialidades médicas en el último año.

**42. Estudios complementarios más solicitados**
Determinar qué estudios de laboratorio e imagenología son más frecuentemente ordenados en conjunto por los médicos.

**43. Análisis de citas canceladas vs completadas**
Comparar mediante UNION las citas médicas completadas versus las canceladas, analizando patrones por especialidad y horario.

**44. Medicamentos exclusivos por especialidad**
Usar EXCEPT para identificar medicamentos que son recetados únicamente por una especialidad médica específica y no por otras.

---

*Nivel Intermedio completado. Estas consultas involucran análisis más complejos con agregaciones, agrupamientos, operaciones de conjuntos, subconsultas avanzadas y correlaciones entre múltiples entidades del sistema médico.*

## Avanzado

**45. Ranking de médicos por productividad con percentiles**
Utilizar funciones de ventana ROW_NUMBER(), RANK() y NTILE() para generar un ranking completo de médicos por número de consultas, incluyendo percentiles y comparación con promedios móviles trimestrales.

**46. Análisis de trayectoria médica de pacientes con CTEs**
Implementar Common Table Expressions para rastrear la trayectoria completa de atención médica de cada paciente, desde consulta inicial hasta tratamientos, estudios y seguimientos posteriores.

**47. Pivot de distribución de enfermedades por grupo etario**
Crear una matriz pivotada que muestre la distribución de diagnósticos médicos con grupos de edad como filas y tipos de enfermedades como columnas, incluyendo totales y porcentajes.

**48. Consulta recursiva para seguimiento de tratamientos**
Desarrollar una consulta recursiva que trace la cadena completa de seguimiento médico de un paciente, mostrando consultas iniciales, derivaciones, estudios ordenados y consultas de control posteriores.

**49. Window functions para análisis temporal de síntomas**
Implementar funciones de ventana LAG y LEAD para comparar la evolución de síntomas reportados por pacientes entre consultas consecutivas, identificando mejorías o deterioros.

**50. CTE recursivo para estructura de dependientes familiares**
Utilizar CTEs recursivos para mostrar la estructura jerárquica completa de familias atendidas, incluyendo clientes principales y todos sus niveles de dependientes.

**51. Pivot de uso de servicios médicos por mes**
Crear una matriz pivot que muestre el uso de diferentes servicios médicos (consultas, laboratorio, imagenología, farmacia) por mes, facilitando análisis de estacionalidad.

**52. Funciones de ventana para análisis de ocupación médica**
Utilizar window functions con marcos personalizados (ROWS BETWEEN) para calcular promedios móviles de ocupación de médicos y identificar patrones de carga de trabajo.

**53. CTE complejo para análisis de eficiencia de tratamientos**
Implementar múltiples CTEs anidados para analizar la efectividad de diferentes tratamientos médicos, correlacionando prescripciones, adherencia y resultados clínicos.

**54. Consulta recursiva para cadena de derivaciones médicas**
Desarrollar una consulta recursiva que trace todas las derivaciones médicas desde medicina general hasta especialistas, mostrando la ruta completa de referencia entre médicos.

**55. Window functions con particiones múltiples por especialidad**
Implementar análisis complejos utilizando funciones de ventana con particiones simultáneas por especialidad médica, turno y mes para comparaciones multidimensionales de productividad.

**56. Pivot de resultados de laboratorio por parámetros**
Crear una matriz pivotada de resultados de análisis clínicos que muestre pacientes como filas y diferentes parámetros de laboratorio como columnas, incluyendo valores de referencia.

**57. CTE para análisis de patrones de prescripción médica**
Utilizar CTEs complejos para identificar patrones de prescripción de medicamentos por médico, detectando posibles inconsistencias o tendencias en la práctica clínica.

**58. Funciones de ventana para ranking de medicamentos por eficacia**
Implementar window functions para rankear medicamentos por eficacia basada en seguimiento de pacientes, utilizando FIRST_VALUE y LAST_VALUE para comparaciones.

**59. Consulta recursiva para historial médico familiar**
Desarrollar una consulta recursiva que construya el árbol genealógico médico de familias, incluyendo antecedentes hereditarios y patrones de enfermedades familiares.

**60. Pivot complejo de ocupación de recursos médicos**
Crear una matriz pivot multidimensional que muestre la ocupación de diferentes recursos (consultorios, equipos de imagenología, laboratorio) por día de la semana y horario.

**61. Window functions para análisis de tendencias de salud poblacional**
Utilizar funciones de ventana avanzadas para analizar tendencias de salud en la población atendida, identificando incrementos o decrementos en tipos específicos de enfermedades.

**62. CTE recursivo para seguimiento de epidemias locales**
Implementar CTEs recursivos para rastrear la propagación de enfermedades contagiosas entre pacientes atendidos, identificando posibles cadenas de contagio y focos de infección.

**63. Pivot de análisis financiero por servicio y período**
Crear una matriz pivot que muestre ingresos por tipo de servicio médico como filas y meses como columnas, incluyendo totales acumulados y variaciones porcentuales.

**64. Window functions con agregaciones complejas para KPIs médicos**
Implementar funciones de ventana que combinen múltiples agregaciones (COUNT, SUM, AVG) con particiones personalizadas para generar indicadores clave de desempeño médico en tiempo real.

---

*Nivel Avanzado completado. Estas consultas se enfocan exclusivamente en las cuatro técnicas SQL avanzadas: CTEs complejos, consultas recursivas, operaciones PIVOT, y funciones de ventana (window functions) aplicadas al dominio médico.*

## Experto

**65. Análisis analítico de riesgo de readmisión con CTEs complejos**
Utilizar WITH (CTEs) y funciones de ventana ROW_NUMBER(), RANK() para analizar patrones de readmisión de pacientes, calculando probabilidades basadas en variables como edad, diagnósticos previos y adherencia al tratamiento.

**66. Segmentación analítica de pacientes con window functions**
Implementar funciones de ventana NTILE(), PERCENT_RANK() y CUME_DIST() para segmentar pacientes en quintiles basados en múltiples métricas de riesgo, creando perfiles analíticos para medicina personalizada.

**67. Optimización de protocolos de tratamiento con MERGE**
Utilizar la instrucción MERGE con OUTPUT para actualizar protocolos de tratamiento basados en outcomes de casos similares, manteniendo trazabilidad completa de cambios y versiones históricas.

**68. Análisis de texto en registros médicos con STRING_SPLIT y JSON**
Implementar JSON_VALUE y STRING_SPLIT para analizar notas clínicas estructuradas, extraer síntomas clave, clasificar severidad y correlacionar con resultados mediante técnicas SQL analíticas avanzadas.

**69. Análisis de tendencias de demanda con window functions temporales**
Desarrollar consultas analíticas con LAG, LEAD y marcos de ventana temporales para identificar patrones estacionales en demanda de servicios médicos, calculando tasas de crecimiento y proyecciones basadas en datos históricos.

**70. Optimización de asignación de citas con CTEs recursivos**
Implementar WITH recursivo y window functions para optimizar la programación de citas médicas, considerando urgencia, disponibilidad de especialistas y recursos, utilizando técnicas SQL de optimización analítica.

**71. Análisis de patrones de contagio con grafos en SQL**
Utilizar CTEs recursivos y CONNECT BY para modelar redes de contacto entre pacientes, identificar cadenas de transmisión y calcular métricas de centralidad usando funciones analíticas SQL avanzadas.

**72. Dashboard analítico con indicadores dinámicos**
Desarrollar consultas analíticas complejas que combinen múltiples CTEs, window functions y MERGE para generar indicadores clínicos en tiempo real, utilizando OUTPUT para auditoría de cambios críticos.

**73. Análisis de supervivencia con funciones de ventana avanzadas**
Implementar análisis de supervivencia utilizando LAG, LEAD, FIRST_VALUE y LAST_VALUE para calcular tiempo hasta eventos críticos, tasas de supervivencia por cohortes y factores pronósticos mediante SQL analítico.

**74. Sistema de diagnóstico diferencial con CTEs y ranking analítico**
Desarrollar consultas analíticas complejas que utilicen WITH, ROW_NUMBER() y PERCENT_RANK() para generar diagnósticos diferenciales probabilísticos basados en síntomas, signos clínicos y resultados de laboratorio.

**75. Optimización analítica de inventario farmacéutico**
Crear consultas avanzadas con window functions, LEAD/LAG y CTEs para optimizar inventario de medicamentos, calculando puntos de reorden, rotación y predicciones basadas en patrones históricos usando SQL analítico.

**76. Análisis de adherencia con funciones de ventana temporales**
Desarrollar consultas analíticas que utilicen marcos de ventana temporales (ROWS BETWEEN) para analizar patrones de adherencia a tratamientos, identificando factores críticos mediante técnicas SQL avanzadas.

**77. Detección de anomalías en medicamentos con SQL analítico**
Implementar consultas avanzadas con PERCENT_RANK(), CUME_DIST() y outlier detection usando funciones de ventana para identificar patrones inusuales que sugieran efectos adversos o interacciones medicamentosas.

**78. Sistema de alertas con CTEs y análisis de umbrales**
Crear consultas analíticas avanzadas que utilicen WITH y funciones de ventana para analizar signos vitales y resultados de laboratorio, detectando patrones críticos mediante técnicas de percentiles y análisis de desviaciones.

**79. Análisis de eficiencia operativa con window functions**
Integrar datos operativos utilizando CTEs complejos, APPLY y funciones de ventana para optimizar flujos de trabajo clínicos, calcular métricas de utilización de equipos y eficiencia del personal mediante SQL analítico.

**80. Modelo de pricing con análisis competitivo SQL**
Desarrollar consultas analíticas que utilicen MERGE, OUTPUT y window functions para ajustar costos de servicios médicos basado en análisis de demanda, complejidad y benchmarking competitivo usando técnicas SQL avanzadas.

**81. Análisis epidemiológico con CTEs recursivos y ventanas**
Implementar consultas recursivas complejas y funciones de ventana temporal para analizar patrones epidemiológicos, calcular tasas de reproducción y identificar tendencias usando SQL analítico avanzado.

**82. Optimización de asignación médico-paciente con ranking**
Utilizar funciones de ventana ROW_NUMBER(), RANK() y DENSE_RANK() combinadas con CTEs para optimizar la asignación de pacientes a especialistas basada en compatibilidad, experiencia y outcomes históricos.

**83. Análisis longitudinal de calidad de vida con LAG/LEAD**
Aplicar funciones de ventana temporales LAG, LEAD y marcos deslizantes para analizar la evolución de calidad de vida post-tratamiento, identificando patrones de mejora mediante SQL analítico.

**84. Análisis estructurado de imágenes médicas con JSON**
Implementar consultas avanzadas con JSON_VALUE, STRING_SPLIT y funciones analíticas para procesar metadatos de imágenes médicas, extraer hallazgos estructurados y generar reportes automatizados usando SQL experto.

---

*Nivel Experto completado. Estas consultas utilizan las técnicas SQL más sofisticadas: CTEs complejos, funciones de ventana avanzadas, MERGE con OUTPUT, análisis con JSON, y optimización analítica para resolver problemas médicos complejos mediante SQL de nivel experto.*